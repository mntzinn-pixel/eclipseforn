<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin - Minha Loja</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
.topbar{background:#111827;padding:15px;display:flex;align-items:center;font-weight:bold}
.menu-btn{cursor:pointer;margin-right:15px;font-size:20px}
.sidebar{position:fixed;left:-250px;top:0;width:250px;height:100%;background:#111827;padding-top:60px;transition:.3s}
.sidebar div{padding:15px;cursor:pointer}
.sidebar div:hover{background:#1f2937}
.sidebar.active{left:0}
.content{padding:20px}
.card{background:#1f2937;padding:20px;border-radius:12px;margin-bottom:20px}
.hidden{display:none}
button{padding:6px 12px;border:none;border-radius:6px;cursor:pointer}
.btn{background:#2563eb;color:white}
.btn-del{background:#dc2626;color:white}
input,select{width:100%;padding:8px;margin:5px 0;background:#111827;border:1px solid #374151;color:white}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #374151}
.badge{padding:4px 8px;border-radius:6px;font-size:12px}
.novo{background:#facc15;color:black}
.pago{background:#22c55e}
.enviado{background:#3b82f6}
.cancelado{background:#ef4444}
</style>
</head>

<body>

<div class="topbar">
<div class="menu-btn" onclick="toggleMenu()">☰</div>
Painel Administrativo
</div>

<div class="sidebar" id="sidebar">
<div onclick="mostrar('dashboard')">Dashboard</div>
<div onclick="mostrar('produtos')">Produtos</div>
<div onclick="mostrar('pedidos')">Pedidos</div>
<div onclick="mostrar('clientes')">Clientes</div>
<div onclick="logout()">Sair</div>
</div>

<div class="content">

<!-- DASHBOARD -->
<div id="dashboard">
<div class="card">
<h3>Resumo</h3>
<p>Total Vendido: R$ <span id="totalVendido">0</span></p>
<p>Total Pedidos: <span id="totalPedidos">0</span></p>
<p>Ticket Médio: R$ <span id="ticketMedio">0</span></p>
<canvas id="grafico"></canvas>
</div>
</div>

<!-- PRODUTOS -->
<div id="produtos" class="hidden">
<div class="card">
<h3>Novo Produto</h3>
<input id="pNome" placeholder="Nome">
<input id="pPreco" type="number" placeholder="Preço">
<input id="pEstoque" type="number" placeholder="Estoque">
<input id="pImagem" placeholder="Imagem URL">
<button class="btn" onclick="salvarProduto()">Salvar</button>
</div>
<div class="card">
<table>
<thead><tr><th>Nome</th><th>Preço</th><th>Estoque</th><th>Ações</th></tr></thead>
<tbody id="listaProdutos"></tbody>
</table>
</div>
</div>

<!-- PEDIDOS -->
<div id="pedidos" class="hidden">
<div class="card">
<h3>Pedidos</h3>
<table>
<thead><tr><th>Cliente</th><th>Total</th><th>Status</th><th>Ações</th></tr></thead>
<tbody id="listaPedidos"></tbody>
</table>
</div>
</div>

<!-- CLIENTES -->
<div id="clientes" class="hidden">
<div class="card">
<h3>Clientes</h3>
<table>
<thead><tr><th>Email</th><th>Total Gasto</th><th>Pedidos</th></tr></thead>
<tbody id="listaClientes"></tbody>
</table>
</div>
</div>

</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
authDomain:"minha-loja-digital1.firebaseapp.com",
projectId:"minha-loja-digital1"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const sidebar=document.getElementById("sidebar");
function toggleMenu(){sidebar.classList.toggle("active")}
function mostrar(sec){
["dashboard","produtos","pedidos","clientes"].forEach(s=>{
document.getElementById(s).classList.add("hidden")
});
document.getElementById(sec).classList.remove("hidden");
sidebar.classList.remove("active");
}
document.addEventListener("click",e=>{
if(!sidebar.contains(e.target)&&!e.target.classList.contains("menu-btn")){
sidebar.classList.remove("active")
}
});

function logout(){firebase.auth().signOut()}

/* DASHBOARD */
let grafico;
db.collection("pedidos").onSnapshot(snapshot=>{
let total=0;
let pedidos=snapshot.size;
snapshot.forEach(doc=>{total+=doc.data().total||0});
document.getElementById("totalVendido").innerText=total.toFixed(2);
document.getElementById("totalPedidos").innerText=pedidos;
document.getElementById("ticketMedio").innerText=(pedidos?total/pedidos:0).toFixed(2);

if(grafico)grafico.destroy();
grafico=new Chart(document.getElementById("grafico"),{
type:"bar",
data:{labels:["Vendas"],datasets:[{label:"Total",data:[total]}]}
});
});

/* PRODUTOS */
function salvarProduto(){
db.collection("produtos").add({
nome:pNome.value,
preco:parseFloat(pPreco.value),
estoque:parseInt(pEstoque.value),
imagem:pImagem.value
});
pNome.value="";pPreco.value="";pEstoque.value="";pImagem.value="";
}
db.collection("produtos").onSnapshot(snapshot=>{
listaProdutos.innerHTML="";
snapshot.forEach(doc=>{
let p=doc.data();
let alerta=p.estoque<=5?"⚠️":"";
listaProdutos.innerHTML+=`
<tr>
<td>${p.nome}</td>
<td>R$ ${p.preco}</td>
<td>${p.estoque} ${alerta}</td>
<td><button class="btn-del" onclick="db.collection('produtos').doc('${doc.id}').delete()">Excluir</button></td>
</tr>`;
});
});

/* PEDIDOS */
db.collection("pedidos").onSnapshot(snapshot=>{
listaPedidos.innerHTML="";
snapshot.forEach(doc=>{
let p=doc.data();
listaPedidos.innerHTML+=`
<tr>
<td>${p.cliente||"---"}</td>
<td>R$ ${p.total}</td>
<td><span class="badge ${p.status||'novo'}">${p.status||"novo"}</span></td>
<td>
<select onchange="alterarStatus('${doc.id}',this.value)">
<option>novo</option>
<option>pago</option>
<option>enviado</option>
<option>cancelado</option>
</select>
</td>
</tr>`;
});
});
function alterarStatus(id,status){
db.collection("pedidos").doc(id).update({status});
}

/* CLIENTES */
db.collection("pedidos").onSnapshot(snapshot=>{
let clientes={};
snapshot.forEach(doc=>{
let p=doc.data();
if(!p.cliente)return;
if(!clientes[p.cliente])clientes[p.cliente]={total:0,pedidos:0};
clientes[p.cliente].total+=p.total||0;
clientes[p.cliente].pedidos+=1;
});
listaClientes.innerHTML="";
for(let email in clientes){
listaClientes.innerHTML+=`
<tr>
<td>${email}</td>
<td>R$ ${clientes[email].total.toFixed(2)}</td>
<td>${clientes[email].pedidos}</td>
</tr>`;
}
});
</script>

</body>
</html>
