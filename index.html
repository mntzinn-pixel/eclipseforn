<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Minha Loja</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
body { margin:0; font-family:Arial; background:#f4f6f9; }
header { background:#111; color:white; padding:15px; text-align:center; font-size:20px; }
.container { padding:20px; max-width:1200px; margin:auto; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; }
.card { background:white; border-radius:10px; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,0.08); }
.card img { width:100%; height:220px; object-fit:cover; }
.card-body { padding:15px; }
button { padding:8px 12px; border:none; border-radius:5px; cursor:pointer; margin-top:5px; }
.btn-dark { background:#111; color:white; }
.btn-green { background:#25D366; color:white; }
.btn-red { background:red; color:white; }
.area { background:white; padding:20px; border-radius:10px; margin-top:25px; box-shadow:0 3px 10px rgba(0,0,0,0.05); }
.floating {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#25D366;
  color:white;
  padding:15px;
  border-radius:50%;
  font-size:20px;
  text-decoration:none;
}
</style>
</head>

<body>

<header>üõç Minha Loja</header>

<div class="container">

<h2>Produtos</h2>
<div class="grid" id="lista"></div>

<div class="area">
<h3>üõí Carrinho</h3>
<div id="carrinho"></div>
<h4 id="total">Total: R$ 0</h4>
<button onclick="finalizarPedido()" class="btn-green">
Finalizar Pedido
</button>
</div>

</div>

<a class="floating" href="https://wa.me/5531993178577" target="_blank">üí¨</a>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
  authDomain: "minha-loja-digital1.firebaseapp.com",
  projectId: "minha-loja-digital1",
  storageBucket: "minha-loja-digital1.firebasestorage.app",
  messagingSenderId: "119834670597",
  appId: "1:119834670597:web:36edb828d7fdded6678e6c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let carrinho = [];

function carregarProdutos(){
  db.collection("produtos").get().then(snapshot=>{
    const div = document.getElementById("lista");
    div.innerHTML = "";

    snapshot.forEach(doc=>{
      const p = doc.data();

      div.innerHTML += `
        <div class="card">
          <img src="${p.imagem}">
          <div class="card-body">
            <h4>${p.nome}</h4>
            <p>R$ ${p.preco}</p>
            <button onclick="addCarrinho('${p.nome}', ${p.preco})" class="btn-dark">
              Adicionar
            </button>
          </div>
        </div>
      `;
    });
  });
}

function addCarrinho(nome, preco){
  carrinho.push({nome, preco});
  atualizarCarrinho();
}

function atualizarCarrinho(){
  let div = document.getElementById("carrinho");
  div.innerHTML = "";
  let total = 0;

  carrinho.forEach((item,i)=>{
    total += item.preco;
    div.innerHTML += `
      <div>
        ${item.nome} - R$ ${item.preco}
        <button onclick="remover(${i})" class="btn-red">X</button>
      </div>
    `;
  });

  document.getElementById("total").innerText =
    "Total: R$ " + total.toFixed(2);
}

function remover(i){
  carrinho.splice(i,1);
  atualizarCarrinho();
}

function finalizarPedido(){

  if(carrinho.length == 0){
    alert("Carrinho vazio!");
    return;
  }

  let total = 0;
  carrinho.forEach(item=> total += item.preco);

  db.collection("pedidos").add({
    itens: carrinho,
    total: total,
    data: new Date(),
    status: "Novo"
  });

  let mensagem = "Ol√°, novo pedido:%0A%0A";
  carrinho.forEach(item=>{
    mensagem += "- " + item.nome + " - R$ " + item.preco + "%0A";
  });
  mensagem += "%0ATotal: R$ " + total.toFixed(2);

  window.open("https://wa.me/5531993178577?text=" + mensagem);

  carrinho = [];
  atualizarCarrinho();
  alert("Pedido enviado!");
}

carregarProdutos();
</script>

</body>
</html>
