<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;font-size:14px}
.topbar{background:#111827;padding:12px;display:flex;justify-content:space-between;align-items:center}
.sidebar{position:fixed;top:0;left:-240px;width:220px;height:100%;background:#111827;padding:15px;transition:.3s}
.sidebar.active{left:0}
.sidebar button{width:100%;padding:10px;margin-bottom:8px;background:#1f2937;border:none;color:white;border-radius:6px}
.content{padding:12px}
.card{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:12px}
input,select{width:100%;padding:8px;margin:5px 0;background:#0f172a;border:1px solid #374151;color:white;border-radius:6px}
button.primary{background:#2563eb;border:none;padding:10px;border-radius:6px;color:white;width:100%}
.stat{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:8px}
.hidden{display:none}
img{width:45px;height:45px;object-fit:cover;border-radius:6px}
</style>
</head>
<body>

<div id="loginPage" class="card" style="max-width:300px;margin:100px auto">
<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button id="btnLogin" class="primary">Entrar</button>
</div>

<div id="app" class="hidden">

<div class="topbar">
<button id="menuBtn">☰</button>
<span>Painel</span>
</div>

<div id="sidebar" class="sidebar">
<button data-page="dashboard">Dashboard</button>
<button data-page="produtos">Produtos</button>
<button data-page="categorias">Categorias</button>
<button data-page="pedidos">Pedidos</button>
<button id="logout">Sair</button>
</div>

<div class="content">

<div id="dashboard" class="page">
<div class="stat">Produtos: <span id="totalProdutos">0</span></div>
<div class="stat">Categorias: <span id="totalCategorias">0</span></div>
<div class="stat">Pedidos: <span id="totalPedidos">0</span></div>
<div class="stat">Total Vendido: R$ <span id="totalVendido">0</span></div>
</div>

<div id="produtos" class="page hidden">
<div class="card">
<input id="pNome" placeholder="Nome">
<input id="pPreco" type="number" placeholder="Preço">
<input id="pEstoque" type="number" placeholder="Estoque">
<select id="pCategoria"></select>
<input type="file" id="pImagem">
<button id="salvarProduto" class="primary">Salvar Produto</button>
</div>
<div id="listaProdutos"></div>
</div>

<div id="categorias" class="page hidden">
<div class="card">
<input id="cNome" placeholder="Nome da categoria">
<button id="salvarCategoria" class="primary">Salvar Categoria</button>
</div>
<div id="listaCategorias"></div>
</div>

<div id="pedidos" class="page hidden">
<div id="listaPedidos"></div>
</div>

</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
authDomain:"minha-loja-digital1.firebaseapp.com",
projectId:"minha-loja-digital1",
storageBucket:"minha-loja-digital1.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

let editId=null;

const loginPage=document.getElementById("loginPage");
const app=document.getElementById("app");

auth.onAuthStateChanged(user=>{
if(user){
loginPage.classList.add("hidden");
app.classList.remove("hidden");
carregarDashboard();
}else{
loginPage.classList.remove("hidden");
app.classList.add("hidden");
}
});

document.getElementById("btnLogin").onclick=()=>{
auth.signInWithEmailAndPassword(
document.getElementById("email").value,
document.getElementById("senha").value
).catch(e=>alert(e.message));
};

document.getElementById("logout").onclick=()=>auth.signOut();

document.getElementById("menuBtn").onclick=()=>{
document.getElementById("sidebar").classList.toggle("active");
};

document.querySelectorAll("[data-page]").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
document.getElementById(btn.dataset.page).classList.remove("hidden");
document.getElementById("sidebar").classList.remove("active");
};
});

function carregarDashboard(){
db.collection("produtos").onSnapshot(s=>{
document.getElementById("totalProdutos").innerText=s.size;
});
db.collection("categorias").onSnapshot(s=>{
document.getElementById("totalCategorias").innerText=s.size;
});
db.collection("vendas").onSnapshot(s=>{
document.getElementById("totalPedidos").innerText=s.size;
let total=0;
s.forEach(doc=>total+=doc.data().total||0);
document.getElementById("totalVendido").innerText=total.toFixed(2);
});
}

/* CATEGORIAS */
document.getElementById("salvarCategoria").onclick=()=>{
let nome=document.getElementById("cNome").value;
if(!nome)return;
db.collection("categorias").add({nome});
document.getElementById("cNome").value="";
};

db.collection("categorias").onSnapshot(s=>{
let lista="";
let select="<option value=''>Selecione categoria</option>";
s.forEach(doc=>{
lista+=`<div>${doc.data().nome}</div>`;
select+=`<option value="${doc.data().nome}">${doc.data().nome}</option>`;
});
document.getElementById("listaCategorias").innerHTML=lista;
document.getElementById("pCategoria").innerHTML=select;
});

/* PRODUTOS */
document.getElementById("salvarProduto").onclick=async()=>{
let nome=document.getElementById("pNome").value;
let preco=document.getElementById("pPreco").value;
let estoque=document.getElementById("pEstoque").value;
let categoria=document.getElementById("pCategoria").value;
let imagemInput=document.getElementById("pImagem");

if(!nome||!preco||!categoria){alert("Preencha tudo");return;}

let imagemURL="";

if(imagemInput.files.length>0){
let file=imagemInput.files[0];
let ref=storage.ref("produtos/"+Date.now()+"_"+file.name);
await ref.put(file);
imagemURL=await ref.getDownloadURL();
}

let dados={
nome,
preco:parseFloat(preco),
estoque:parseInt(estoque)||0,
categoria
};

if(imagemURL)dados.imagem=imagemURL;

if(editId){
await db.collection("produtos").doc(editId).update(dados);
editId=null;
}else{
await db.collection("produtos").add(dados);
}

document.getElementById("pNome").value="";
document.getElementById("pPreco").value="";
document.getElementById("pEstoque").value="";
document.getElementById("pImagem").value="";
};

db.collection("produtos").onSnapshot(s=>{
let html="";
s.forEach(doc=>{
let p=doc.data();
html+=`
<div class="card">
${p.imagem?`<img src="${p.imagem}">`:""}
<div>${p.nome}</div>
<div>R$ ${p.preco}</div>
<button onclick="editId='${doc.id}';document.getElementById('pNome').value='${p.nome}';document.getElementById('pPreco').value='${p.preco}';document.getElementById('pEstoque').value='${p.estoque||0}';document.getElementById('pCategoria').value='${p.categoria}'">Editar</button>
<button onclick="db.collection('produtos').doc('${doc.id}').delete()">Excluir</button>
</div>`;
});
document.getElementById("listaProdutos").innerHTML=html;
});
</script>

</body>
</html>
