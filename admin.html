<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin - Minha Loja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>

<body style="font-family: Arial; padding:20px; background:#f5f5f5;">

  <div id="login-area">
    <h2>ğŸ” Login Admin</h2>
    <input type="email" id="email" placeholder="Email" style="padding:10px;width:100%;margin-bottom:10px;">
    <input type="password" id="senha" placeholder="Senha" style="padding:10px;width:100%;margin-bottom:10px;">
    <button onclick="login()" style="padding:10px;width:100%;background:black;color:white;border:none;">
      Entrar
    </button>
  </div>

  <div id="admin-area" style="display:none;">
    <h1>Painel Admin</h1>
    <button onclick="logout()" style="margin-bottom:20px;">Sair</button>

    <input type="text" id="nome" placeholder="Nome do produto" style="padding:10px;width:100%;margin-bottom:10px;">
    <input type="number" id="preco" placeholder="PreÃ§o" style="padding:10px;width:100%;margin-bottom:10px;">
    <input type="text" id="categoria" placeholder="Categoria" style="padding:10px;width:100%;margin-bottom:10px;">
    <input type="file" id="imagem" accept="image/*" style="margin-bottom:10px;">
    <button onclick="cadastrarProduto()" style="padding:10px;width:100%;background:green;color:white;border:none;">
      Cadastrar
    </button>

    <hr>
    <div id="lista-admin"></div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
  authDomain: "minha-loja-digital1.firebaseapp.com",
  projectId: "minha-loja-digital1",
  storageBucket: "minha-loja-digital1.firebasestorage.app",
  messagingSenderId: "119834670597",
  appId: "1:119834670597:web:36edb828d7fdded6678e6c"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const auth = firebase.auth();

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("login-area").style.display = "none";
    document.getElementById("admin-area").style.display = "block";
    carregarAdmin();
  } else {
    document.getElementById("login-area").style.display = "block";
    document.getElementById("admin-area").style.display = "none";
  }
});

function login() {
  const email = document.getElementById("email").value;
  const senha = document.getElementById("senha").value;

  auth.signInWithEmailAndPassword(email, senha)
    .catch(error => alert(error.message));
}

function logout() {
  auth.signOut();
}

function cadastrarProduto() {
  const nome = document.getElementById("nome").value;
  const preco = document.getElementById("preco").value;
  const categoria = document.getElementById("categoria").value;
  const arquivo = document.getElementById("imagem").files[0];

  if (!nome || !preco || !categoria || !arquivo) {
    alert("Preencha todos os campos!");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    db.collection("produtos").add({
      nome,
      preco: parseFloat(preco),
      categoria,
      imagem: e.target.result,
      criadoEm: new Date()
    }).then(() => {
      carregarAdmin();
    });
  };
  reader.readAsDataURL(arquivo);
}

function excluirProduto(id) {
  db.collection("produtos").doc(id).delete().then(() => {
    carregarAdmin();
  });
}

function carregarAdmin() {
  const lista = document.getElementById("lista-admin");
  lista.innerHTML = "";

  db.collection("produtos").get().then(snapshot => {
    snapshot.forEach(doc => {
      const data = doc.data();

      lista.innerHTML += `
        <div style="background:white;padding:10px;margin:10px 0;border-radius:6px;">
          ${data.nome} - R$ ${data.preco}
          <button onclick="excluirProduto('${doc.id}')" style="background:red;color:white;border:none;">Excluir</button>
        </div>
      `;
    });
  });
}
</script>

</body>
</html>
